# Calico Image Assurance Vulnerability Management with Jenkins and Google Artifact Registry

![Calico Logo](/images/logo/Tigera-Logo-Transparent.png)

Automate the integration of **Calico Image Assurance** with **Jenkins Build Pipeline** and **Google Artifact Registry** to manage vulnerabilities efficiently. 

## Table of Contents

- [Overview](#overview)
- [Requirements](#requirements)
- [How to Use](#how-to-use)
- [Customization](#customization)
- [Contribution](#contribution)
- [License](#license)
- [Support](#support)

## Overview

This repository contains a Jenkins pipeline script that helps users integrate **Calico Image Assurance** with **Jenkins** and **Google Artifact Registry** for vulnerability management. The script automates the process of scanning Docker images during the build phase to ensure only secure and compliant images are deployed.

The pipeline includes the following stages:
- **Checkout**: Retrieve the project source code.
- **Set COMMIT_HASH**: Generate a unique identifier for the Docker image.
- **Authenticate with Artifact Registry**: Configure authentication with Google Artifact Registry.
- **Build Docker Image**: Create the Docker image using the specified Dockerfile.
- **Scan Docker Image**: Use Calico Image Assurance to scan the image for vulnerabilities.
- **Push Docker Image**: Push the verified Docker image to Google Artifact Registry.

## Requirements

Ensure you have the following tools and credentials available:

- **Jenkins** installed and configured for your project.
- **Google Cloud CLI** ([gcloud](https://cloud.google.com/sdk)) installed for authentication and registry configuration.
- **Docker** installed on your Jenkins agent to build and push Docker images.
- **Calico Enterprise** or **Calico Cloud** installed in your Kubernetes cluster.
- **Google Artifact Registry** set up in your Google Cloud project.
- **Calico Scanner Token** and **Google Service Account Key** configured in Jenkins as credentials.

## How to Use

1. Clone the repository to your local machine:
   ```bash
   git clone https://github.com/tigera-cs/jenkins-cicd-calico-scanner.git
   ```

   Navigate to the script directory:
   ```bash
   cd calico-automation-central/Vulnerability_Management/Jenkins-Pipeline-Integration-with-Google-Artifactory
   ```
2. Configure the Jenkinsfile:
   - Update the environment variables in the Jenkinsfile to match your Google Cloud project and registry settings.

3. Set up Jenkins Credentials:
   - **Google Service Account Key**: Add the key file to Jenkins as a credential (`gcp-service-account-key`).
   - **Calico Scanner Token**: Add the Calico scanner token to Jenkins as a credential (`calico-scanner-token`).

4. Create a Jenkins pipeline job and point it to this repository.

5. Run the Jenkins pipeline to build, scan, and push the Docker image.

## Customization

- **Environment Variables**: Modify the environment variables in the Jenkinsfile to match your project configuration, including `PROJECT_ID`, `IMAGE_NAME`, and `REPO_NAME`.
- **Scanner Configuration**: Adjust the `CALICO_SCANNER_FAIL_THRESHOLD` and `CALICO_SCANNER_WARN_THRESHOLD` values to customize the vulnerability thresholds for your project.
- **Docker Image**: Update the Dockerfile as needed for your specific application requirements.

## Contribution

We welcome contributions from the community! To contribute, follow these steps:

- Fork this repository.
- Create a new branch with a descriptive name.
- Make your changes and commit them with clear messages.
- Push your changes to your fork.
- Submit a pull request with a detailed description of your changes.

## License

This project is licensed under the [MIT License](LICENSE).

## Support

If you need support or have questions, check out our community forum or contact the maintainers via [email/issue tracker].
